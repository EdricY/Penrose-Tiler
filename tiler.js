/*! For license information please see tiler.js.LICENSE.txt */
(()=>{var t={56:function(t,e){var n,i;n=function(t){function e(t,e,n){this.obj=t,this.left=null,this.right=null,this.parent=n,this.dimension=e}function n(t){this.content=[],this.scoreFunction=t}n.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var i=this.content.pop();return void(n!=e-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[n]=e,this.content[t]=i,t=n}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);;){var o=2*(t+1),r=o-1,l=null;if(r<e){var a=this.content[r],s=this.scoreFunction(a);s<i&&(l=r)}if(o<e){var h=this.content[o];this.scoreFunction(h)<(null==l?i:s)&&(l=o)}if(null==l)break;this.content[t]=this.content[l],this.content[l]=n,t=l}}},t.kdTree=function(t,i,o){var r,l=this;Array.isArray(t)?this.root=function t(n,i,r){var l,a,s=i%o.length;return 0===n.length?null:1===n.length?new e(n[0],s,r):(n.sort((function(t,e){return t[o[s]]-e[o[s]]})),(a=new e(n[l=Math.floor(n.length/2)],s,r)).left=t(n.slice(0,l),i+1,a),a.right=t(n.slice(l+1),i+1,a),a)}(t,0,null):(r=t,l.root=r,function t(e){e.left&&(e.left.parent=e,t(e.left)),e.right&&(e.right.parent=e,t(e.right))}(l.root)),this.toJSON=function(t){t||(t=this.root);var n=new e(t.obj,t.dimension,null);return t.left&&(n.left=l.toJSON(t.left)),t.right&&(n.right=l.toJSON(t.right)),n},this.insert=function(t){var n,i,r=function e(n,i){if(null===n)return i;var r=o[n.dimension];return t[r]<n.obj[r]?e(n.left,n):e(n.right,n)}(this.root,null);null!==r?(n=new e(t,(r.dimension+1)%o.length,r),i=o[r.dimension],t[i]<r.obj[i]?r.left=n:r.right=n):this.root=new e(t,0,null)},this.empty=function(){return null==this.root},this.isSizeOne=function(){return null==this.root.left&&null==this.root.right},this.remove=function(t){var e;null!==(e=function e(n){if(null===n)return null;if(n.obj===t)return n;var i=o[n.dimension];return t[i]<n.obj[i]?e(n.left):e(n.right)}(l.root))&&function t(e){var n,i,r;function a(t,e){var n,i,r,l,s;return null===t?null:(n=o[e],t.dimension===e?null!==t.left?a(t.left,e):t:(i=t.obj[n],r=a(t.left,e),l=a(t.right,e),s=t,null!==r&&r.obj[n]<i&&(s=r),null!==l&&l.obj[n]<s.obj[n]&&(s=l),s))}if(null===e.left&&null===e.right)return null===e.parent?void(l.root=null):(r=o[e.parent.dimension],void(e.obj[r]<e.parent.obj[r]?e.parent.left=null:e.parent.right=null));null!==e.right?(i=(n=a(e.right,e.dimension)).obj,t(n),e.obj=i):(i=(n=a(e.left,e.dimension)).obj,t(n),e.right=e.left,e.left=null,e.obj=i)}(e)},this.nearest=function(t,e=1,r){var a,s,h;if(h=new n((function(t){return-t[1]})),r)for(a=0;a<e;a+=1)h.push([null,r]);for(l.root&&function n(r){var l,a,s,u,c=o[r.dimension],f=i(t,r.obj),p={};function d(t,n){h.push([t,n]),h.size()>e&&h.pop()}for(u=0;u<o.length;u+=1)u===r.dimension?p[o[u]]=t[o[u]]:p[o[u]]=r.obj[o[u]];a=i(p,r.obj),null!==r.right||null!==r.left?(n(l=null===r.right?r.left:null===r.left?r.right:t[c]<r.obj[c]?r.left:r.right),(h.size()<e||f<h.peek()[1])&&d(r,f),(h.size()<e||Math.abs(a)<h.peek()[1])&&null!==(s=l===r.left?r.right:r.left)&&n(s)):(h.size()<e||f<h.peek()[1])&&d(r,f)}(l.root),s=[],a=0;a<Math.min(e,h.content.length);a+=1)h.content[a][0]&&s.push([h.content[a][0].obj,h.content[a][1]]);return s},this.balanceFactor=function(){return function t(e){return null===e?0:Math.max(t(e.left),t(e.right))+1}(l.root)/(Math.log(function t(e){return null===e?0:t(e.left)+t(e.right)+1}(l.root))/Math.log(2))}},t.BinaryHeap=n},void 0===(i=n.apply(e,[e]))||(t.exports=i)}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}(()=>{"use strict";var t=n(56);const e=600,i=600,o=1.618033988749895,r=.5877852522924731,l=.8090169943749475,a=Math.PI,s=2*a,h=document.getElementById("canvas"),u=new class{constructor(){this.x=0,this.y=0,this.scale=1}moveCtx(t){t.scale(this.scale,this.scale),t.translate(-Math.round(this.x),-Math.round(this.y))}zoomAt(t,n,o){const r=this.scale*(1+o);if(this.scale+o<=.2)return;let l=e/this.scale,a=i/this.scale,s=e/r,h=i/r,u=(t-this.x)/l,c=(n-this.y)/a;this.x=t-s*u,this.y=n-h*c,this.scale=r}};function c(t,e){if(null==t||null==e)return 1/0;const n=t.x-e.x,i=t.y-e.y;return n*n+i*i}function f(t,e,n){return t*n+e*(1-n)}function p(t){return t*(a/180)}function d(t,e){for(;t<0;)t+=e;return t%e}function g(t,e,n){let i=e.x-t.x,o=e.y-t.y,r=n.x-e.x,l=n.y-e.y,a=n.x-t.x,s=n.y-t.y;if(Math.abs(r)+Math.abs(l)<1)return 0;if(Math.abs(a)+Math.abs(s)<1)return 0;let h=o*r-i*l;return Math.abs(h)<1?0:h}function v(t,e){if(t.theta-e.theta%180==0)return!1;let n=g(t.pt1,t.pt2,e.nextPt);if(0==n)return!1;let i=g(t.pt1,t.pt2,e.fromPt);if(0==i)return!1;if(Math.sign(n)==Math.sign(i))return!1;let o=g(e.nextPt,e.fromPt,t.pt1);if(0==o)return!1;let r=g(e.nextPt,e.fromPt,t.pt2);return 0!=r&&Math.sign(o)!=Math.sign(r)}let w=new t.kdTree([],c,["x","y"]);window.tree=w;const b=[0,1,-r,1-l,0,0,r,1-l].map((t=>100*t)),m=[0,0,-r,1-l,0,1-o,r,1-l].map((t=>100*t)),y=Math.PI,x={0:P(b,0),36:P(b,y/5),72:P(b,2*y/5),108:P(b,3*y/5),144:P(b,4*y/5),180:P(b,5*y/5),216:P(b,6*y/5),252:P(b,7*y/5),288:P(b,8*y/5),324:P(b,9*y/5)},F={0:P(m,0),36:P(m,y/5),72:P(m,2*y/5),108:P(m,3*y/5),144:P(m,4*y/5),180:P(m,5*y/5),216:P(m,6*y/5),252:P(m,7*y/5),288:P(m,8*y/5),324:P(m,9*y/5)};function k(t,e){let n=Math.round(t/36)%10;n=d(n,10);let i=36*n;return 0==e?x[i]:F[i]}function P(t,e){let n=Math.sin(e),i=Math.cos(e),o=[];for(let e=0;e<t.length;e+=2){let r=t[e]*i-t[e+1]*n,l=t[e]*n+t[e+1]*i;o.push(r),o.push(l)}return o}class M{constructor(t,e,n,i,o,r){this.face=t,this.nextPt=n,this.fromPt=e,this.blue=o,this.alpha=i,this.theta=d(r,360),this.x=f(e.x,n.x,.5),this.y=f(e.y,n.y,.5)}chain(t){this.next=t,t.prev=this}pair(t){this.opp=t,t.opp=this}matches(t){return this.blue==t.blue&&this.alpha==t.alpha&&this.theta==t.theta&&(this==(e=t)||c(this,e)<1);var e}}class j{constructor(t,e){null==t&&(t=0),null==e&&(e=0),this.vals=[t,e]}get x(){return this.vals[0]}get y(){return this.vals[1]}draw(t,e=2,n="black"){t.fillStyle=n,t.beginPath(),t.arc(this.x,this.y,e,0,s),t.fill()}}function S(t,e){t.moveTo(e[0],e[1]),t.lineTo(e[2],e[3]),t.lineTo(e[4],e[5]),t.lineTo(e[6],e[7]),t.fill()}const T=!0,L=!1,z=!0,E=!1;function A(t,e){return t.alpha==e.alpha&&t.blue==e.blue}class B{constructor(t){this.halfedge=t,null!=t.face&&console.log("it has a face!"),t.face=this;let[e,n,i]=B.orientationForFit(t);this.x=e,this.y=n,this.theta=i;let[o,r,l,a]=B.findPoints(e,n,i);o.halfedge=new M(this,o,r,z,T,i-36),r.halfedge=new M(this,r,l,E,L,i+72),l.halfedge=new M(this,l,a,z,L,i+108),a.halfedge=new M(this,a,o,E,T,i-144);for(let e of[o,r,l,a]){if(A(e.halfedge,t)){e.halfedge=t;continue}let[n]=w.nearest(e.halfedge,1)[0];e.halfedge.matches(n)&&(n.face=this,w.remove(n),e.halfedge=n)}o.halfedge.chain(r.halfedge),r.halfedge.chain(l.halfedge),l.halfedge.chain(a.halfedge),a.halfedge.chain(o.halfedge),o.halfedge.opp||o.halfedge.pair(new M(null,r,o,E,T,i-36+180)),r.halfedge.opp||r.halfedge.pair(new M(null,l,r,z,L,i+72+180)),l.halfedge.opp||l.halfedge.pair(new M(null,a,l,E,L,i+108+180)),a.halfedge.opp||a.halfedge.pair(new M(null,o,a,z,T,i-144+180))}draw(t,e=1,n=!1){let{x:i,y:o,theta:r}=this;B.drawKite(t,i,o,r,e,n)}static isBottom(t){return t.alpha&&t.blue}static isLeft(t){return!t.alpha&&!t.blue}static isTop(t){return t.alpha&&!t.blue}static isRight(t){return!t.alpha&&t.blue}static translationForFit(t){return B.isBottom(t)?[100*r,100*(l-1)]:B.isLeft(t)?[0,0]:B.isTop(t)?[100*-r,100*(l-1)]:B.isRight(t)?[0,-100]:void 0}static rotationForFit(t){return B.isBottom(t)?36:B.isLeft(t)?-72:B.isTop(t)?-108:B.isRight(t)?144:void 0}static orientationForFit(t){let e=B.rotationForFit(t),n=t.theta+e;n=d(n,360);let i=Math.cos(p(n)),o=Math.sin(p(n)),r=B.translationForFit(t);return[r[0]*i-r[1]*o+t.nextPt.x,r[0]*o+r[1]*i+t.nextPt.y,n]}static findPoints(t,e,n){const i=k(n,0);return[new j(t+i[0],e+i[1]),new j(t+i[2],e+i[3]),new j(t+i[4],e+i[5]),new j(t+i[6],e+i[7])]}static getSegments(t){let[e,n,i]=B.orientationForFit(t),[o,r,l,a]=B.findPoints(e,n,i);return[{pt1:o,pt2:r,theta:i-36},{pt1:r,pt2:l,theta:i+72},{pt1:l,pt2:a,theta:i+108},{pt1:a,pt2:o,theta:i-144}]}static drawPreview(t,e,n=1,i=!1){let[o,r,l]=B.orientationForFit(e);B.drawKite(t,o,r,l,n,i)}static drawKite(t,e,n,i,o=1,r=!1){t.save(),t.translate(e,n),t.rotate(p(i)),t.scale(o,o),t.beginPath(),t.fillStyle="lime",S(t,x[0]),r&&t.stroke(),t.lineWidth=5/o,t.beginPath(),t.strokeStyle="red",t.arc(0,0,38.197,.1*a,.9*a),t.stroke(),t.beginPath(),t.strokeStyle="blue",t.arc(0,100,61.803,-.7*a,-.3*a),t.stroke(),t.restore()}}class D{constructor(t){this.halfedge=t,null!=t.face&&console.log("it has a face!"),t.face=this;let[e,n,i]=D.orientationForFit(t);this.x=e,this.y=n,this.theta=i;let[o,r,l,a]=D.findPoints(e,n,i);o.halfedge=new M(this,o,r,E,L,i-108),r.halfedge=new M(this,r,l,z,T,i+36),l.halfedge=new M(this,l,a,E,T,i+144),a.halfedge=new M(this,a,o,z,L,i-72);for(let e of[o,r,l,a]){if(A(e.halfedge,t)){e.halfedge=t;continue}let[n]=w.nearest(e.halfedge,1)[0];e.halfedge.matches(n)&&(n.face=this,w.remove(n),e.halfedge=n)}o.halfedge.chain(r.halfedge),r.halfedge.chain(l.halfedge),l.halfedge.chain(a.halfedge),a.halfedge.chain(o.halfedge),o.halfedge.opp||o.halfedge.pair(new M(null,r,o,z,L,i-108+180)),r.halfedge.opp||r.halfedge.pair(new M(null,l,r,E,T,i+36+180)),l.halfedge.opp||l.halfedge.pair(new M(null,a,l,z,T,i+144+180)),a.halfedge.opp||a.halfedge.pair(new M(null,o,a,E,L,i-72+180))}draw(t,e=1,n=!1){let{x:i,y:o,theta:r}=this;D.drawDart(t,i,o,r,e,n)}static isBottom(t){return!t.alpha&&!t.blue}static isLeft(t){return t.alpha&&t.blue}static isTop(t){return!t.alpha&&t.blue}static isRight(t){return t.alpha&&!t.blue}static translationForFit(t){return D.isBottom(t)?[100*r,100*(l-1)]:D.isLeft(t)?[0,100*(o-1)]:D.isTop(t)?[100*-r,100*(l-1)]:D.isRight(t)?[0,0]:void 0}static rotationForFit(t){return D.isBottom(t)?108:D.isLeft(t)?-36:D.isTop(t)?-144:D.isRight(t)?72:void 0}static orientationForFit(t){let e=D.rotationForFit(t),n=t.theta+e;n=d(n,360);let i=Math.cos(p(n)),o=Math.sin(p(n)),r=D.translationForFit(t);return[r[0]*i-r[1]*o+t.nextPt.x,r[0]*o+r[1]*i+t.nextPt.y,n]}static findPoints(t,e,n){const i=k(n,1);return[new j(t+i[0],e+i[1]),new j(t+i[2],e+i[3]),new j(t+i[4],e+i[5]),new j(t+i[6],e+i[7])]}static getSegments(t){let[e,n,i]=D.orientationForFit(t),[o,r,l,a]=D.findPoints(e,n,i);return[{pt1:o,pt2:r,theta:i-108},{pt1:r,pt2:l,theta:i+36},{pt1:l,pt2:a,theta:i+144},{pt1:a,pt2:o,theta:i-72}]}static drawPreview(t,e,n=1,i=!1){let[o,r,l]=D.orientationForFit(e);D.drawDart(t,o,r,l,n,i)}static drawDart(t,e,n,i,o=1,r=!1){t.save(),t.translate(e,n),t.rotate(p(i)),t.scale(o,o),t.beginPath(),t.fillStyle="yellow",S(t,F[0]),r&&t.stroke(),t.lineWidth=5/o,t.beginPath(),t.strokeStyle="red",t.arc(0,0,.2360689191*100,.9*a,2.1*a),t.stroke(),t.beginPath(),t.strokeStyle="blue",t.arc(0,-61.803,38.197,.3*a,.7*a),t.stroke(),t.restore()}}const O=document.createElement("canvas").getContext("2d");O.canvas.width=e,O.canvas.height=i;const R={x:0,y:0};let C=0;canvas.addEventListener("mousemove",(t=>{R.x=t.offsetX/u.scale+u.x,R.y=t.offsetY/u.scale+u.y})),window.addEventListener("keypress",(t=>{"1"==t.key?C=0:"2"==t.key&&(C=1)}));const I=document.createElement("canvas").getContext("2d");I.canvas.width=e,I.canvas.height=i;const N=[],J=h.getContext("2d");let K;J.canvas.width=e,J.canvas.width=i,requestAnimationFrame((function t(){if(J.clearRect(0,0,e,i),J.save(),u.moveCtx(J),function(){let t=function(){if(w.empty())return null;let t=w.isSizeOne()?null:1e4,e=w.nearest(R,1,t);if(0==e.length)return null;let[n]=e[0];return n}();W=!!(t&&t.opp&&!t.blue&&1==C&&t.opp.face instanceof D),q=t,w.empty()&&w.insert(new M(null,new j(300,400),new j(300,300),!0,!0,0)),Y.w&&(u.y-=5/u.scale),Y.s&&(u.y+=5/u.scale),Y.d&&(u.x+=5/u.scale),Y.a&&(u.x-=5/u.scale)}(),function(t){for(let e=0;e<N.length;e++)N[e].draw(t)}(J),q){if(!W){let t=0==C?B:D;J.globalAlpha=.5,t.drawPreview(J,q),J.globalAlpha=1}n=q,"blue",J.beginPath(),J.strokeStyle="blue",J.arc(n.x,n.y,10,0,2*Math.PI),J.stroke(),J.closePath()}var n;if(K&&U>0){J.save(),J.beginPath();let t=!0;for(let e of K)t=!1,t?J.moveTo(e.pt1.x,e.pt1.y):J.lineTo(e.pt2.x,e.pt2.y);J.closePath(),U=Math.max(0,U-.02),J.globalAlpha=U,J.lineWidth=4,J.strokeStyle="red",J.stroke(),J.restore()}J.restore(),requestAnimationFrame(t)}));let U=0,W=!1,q=null;h.addEventListener("mousedown",(t=>{0==t.button&&function(){if(!q)return;if(W)return;let t=q,e=0==C?B:D,n=e.getSegments(q);if(!function(t,e){for(let[n]of e)for(let e of t)if(v(e,n))return!1;return!0}(n,w.nearest(q,10,22500)))return K=n,void(U=1);let i=new e(q),o=t;do{o=o.next,w.remove(o),null==o.opp.face&&w.insert(o.opp)}while(o!=t);var r;r=i,N.push(r)}(),2==t.button&&function(){if(!q)return;if(w.isSizeOne())return;let t=q.opp.face;if(!t)return;let e=q.opp.face.halfedge,n=e;do{null==n.opp.face?w.remove(n.opp):(n.face=null,w.insert(n)),n=n.next}while(n!=e);!function(t){let e=N.indexOf(t);e>-1&&N.splice(e,1)}(t)}()})),h.addEventListener("contextmenu",(t=>{t.preventDefault()}));let Y={};window.addEventListener("keydown",(t=>{"+"!=t.key&&"="!=t.key||(u.scale+=.1),"-"!=t.key&&"_"!=t.key||(u.scale-=.1),Y[t.key]=!0})),window.addEventListener("mousewheel",(t=>{t.deltaY>0?u.zoomAt(R.x,R.y,-.1):u.zoomAt(R.x,R.y,.1)})),window.addEventListener("keyup",(t=>{Y[t.key]=!1}))})()})();